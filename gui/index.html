<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>ASCII-fy</title>
	<link rel="stylesheet" href="/style.css">
</head>

<body>

	<div class="header">
		<h1>ASCII<span>-fy</span></h1>
		<p class="subtitle">Video ‚Üí ASCII Art</p>
	</div>

	<div class="app">
		<!-- ‚ïê‚ïê‚ïê Left column: Preview ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
		<div class="preview-col">
			<div class="file-header hidden" id="fileHeader">
				<span class="name" id="fileName"></span>
				<button class="change-btn" id="changeFileBtn" type="button">Change</button>
			</div>

			<div class="preview-box" id="previewBox">
				<div class="preview-tabs hidden" id="previewTabs">
					<button class="preview-tab active" id="tabOriginal" type="button">Original<span
							class="tab-size" id="tabOriginalSize"></span></button>
					<button class="preview-tab" id="tabConvertedGif" type="button" disabled>GIF<span
							class="tab-size" id="tabGifSize"></span></button>
					<button class="preview-tab" id="tabConvertedBundle" type="button"
						disabled>bundle.js<span class="tab-size"
							id="tabBundleSize"></span></button>
					<button class="preview-tab" id="tabFramePreview" type="button"
						disabled>Frame</button>
					<button class="undo-btn hidden" id="undoBtn" type="button" disabled
						title="Revert to previous GIF">‚Ü© Undo</button>
				</div>
				<div class="preview-content" id="previewContent">
					<div class="drop-zone" id="dropZone">
						<input type="file" id="fileInput"
							accept=".mp4,.webm,.gif,.mov,.avi,.mkv,.flv" />
						<div class="icon">üé¨</div>
						<div class="label">Drop a video here or click to browse</div>
						<div class="label" style="margin-top:4px;font-size:.75rem">.mp4 .webm
							.gif .mov .avi .mkv</div>
						<div style="margin-top:12px; position:relative; z-index:2">
							<select id="inputSelect"
								style="max-width:260px;text-align:center">
								<option value="">‚Äî or pick from input/ ‚Äî</option>
							</select>
						</div>
						<div style="margin-top:8px; font-size:.78rem; color:var(--muted)">‚Äî or ‚Äî
						</div>
						<button class="btn btn-secondary" id="webcamBtn" type="button"
							style="margin-top:6px; position:relative; z-index:2">üì∑ Use
							Webcam</button>
					</div>
					<div id="previewVideoContainer" class="hidden"
						style="position:relative; width:100%; display:flex; align-items:center; justify-content:center;">
						<video class="preview-video" id="previewVideo" muted loop playsinline
							controls style="max-width:100%; max-height:520px;"></video>
						<div id="cropBox" class="hidden"
							style="position:absolute; border: 2px dashed var(--accent); background: rgba(0, 232, 123, 0.15); cursor: move; touch-action: none; box-sizing: border-box; z-index:5;">
							<div class="crop-handle" data-handle="nw"
								style="top:-5px; left:-5px; cursor:nw-resize;"></div>
							<div class="crop-handle" data-handle="ne"
								style="top:-5px; right:-5px; cursor:ne-resize;"></div>
							<div class="crop-handle" data-handle="sw"
								style="bottom:-5px; left:-5px; cursor:sw-resize;"></div>
							<div class="crop-handle" data-handle="se"
								style="bottom:-5px; right:-5px; cursor:se-resize;">
							</div>
						</div>
					</div>
					<img class="preview-gif hidden" id="previewGif" alt="Converted output" />
					<iframe class="bundle-iframe hidden" id="bundleIframe"></iframe>
					<pre class="bundle-viewer hidden"
						id="bundleViewer"><span class="bundle-viewer-empty">No bundle yet.</span></pre>
					<div class="frame-preview-box hidden" id="framePreview"></div>
				</div>
			</div>

			<div class="preview-bg-bar hidden" id="previewBgBar">
				<span>Preview Background:</span>
				<button class="swatch-btn" data-bg="#000000" style="background:#000000"
					title="Black"></button>
				<button class="swatch-btn" data-bg="#ffffff" style="background:#ffffff"
					title="White"></button>
				<button class="swatch-btn" data-bg="#1a1a2e" style="background:#1a1a2e"
					title="Dark blue"></button>
				<button class="swatch-btn" data-bg="#808080" style="background:#808080"
					title="Grey"></button>
				<button class="swatch-btn checkerboard" data-bg="checkerboard"
					title="Checkerboard"></button>
				<input type="color" id="previewBgCustom" value="#000000" title="Custom colour" />
				<label class="show-raw-js-box hidden" id="showRawJsBox">
					<input type="checkbox" id="showRawJs" /> show raw .js
				</label>
			</div>

			<div class="webcam-bar hidden" id="webcamBar">
				<button class="btn btn-secondary" id="recordStartBtn" type="button" disabled>‚óè
					Record</button>
				<button class="btn btn-secondary" id="recordStopBtn" type="button" disabled>‚ñ†
					Stop</button>
				<span class="status" id="recordStatus">Ready</span>
			</div>

			<div class="info-bar hidden" id="infoBar">
				<div class="info-item"><span class="val" id="infoDims">‚Äî</span> resolution</div>
				<div class="info-item"><span class="val" id="infoFps">‚Äî</span> fps</div>
				<div class="info-item"><span class="val" id="infoFrames">‚Äî</span> frames</div>
				<div class="info-item"><span class="val" id="infoSize">‚Äî</span></div>
			</div>

			<!-- Results (shown under converted preview) -->
			<div class="results" id="resultsArea">
				<div class="result-actions" id="resultActions"></div>
			</div>
		</div>

		<!-- ‚ïê‚ïê‚ïê Right column: Controls ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
		<div class="controls-col">
			<div class="panel" id="controlsPanel">
				<!-- Width -->
				<div class="row">
					<label for="width">Width</label>
					<div class="control">
						<input type="range" id="width" min="20" max="200" value="80" step="5" />
						<span class="range-value" id="widthVal">80</span>
					</div>
				</div>
				<!-- FPS -->
				<div class="row">
					<label for="fps">FPS</label>
					<div class="control">
						<input type="range" id="fps" min="6" max="60" value="24" step="1" />
						<span class="range-value" id="fpsVal">24</span>
					</div>
				</div>
				<!-- Colour mode -->
				<div class="row">
					<label for="mode">Colour mode</label>
					<div class="control">
						<select id="mode">
							<option value="truecolor" selected>Truecolor</option>
							<option value="palette">Palette</option>
							<option value="kmeans">K-Means</option>
							<option value="mono">Monochrome</option>
							<option value="grayscale">Grayscale</option>
						</select>
					</div>
				</div>
				<!-- Palette preset -->
				<div class="row" id="paletteRow">
					<label for="palette">Palette</label>
					<div class="control"
						style="flex-direction:column; align-items:stretch; gap:4px">
						<select id="palette">
							<option value="realistic">Realistic</option>
							<option value="grayscale">Grayscale</option>
							<option value="sunset">Sunset</option>
							<option value="ocean">Ocean</option>
							<option value="neon">Neon</option>
							<option value="forest">Forest</option>
						</select>
						<div class="palette-swatch-bar" id="paletteSwatch"></div>
					</div>
				</div>
				<!-- Depth -->
				<div class="row" id="depthRow">
					<label for="depth">Colours</label>
					<div class="control">
						<input type="range" id="depth" min="2" max="64" value="16" step="1" />
						<span class="range-value" id="depthVal">16</span>
					</div>
				</div>
				<!-- Mono fg -->
				<div class="row" id="monoFgRow">
					<label>Foreground</label>
					<div class="control">
						<input type="color" id="fg" value="#00ff00" />
						<span class="range-value" id="fgVal">#00ff00</span>
					</div>
				</div>
				<!-- Mono bg -->
				<div class="row" id="monoBgRow">
					<label>Background</label>
					<div class="control">
						<input type="color" id="bg" value="#000000" />
						<span class="range-value" id="bgVal">#000000</span>
					</div>
				</div>
				<!-- Char mode -->
				<div class="row">
					<label for="charMode">Char mode</label>
					<div class="control">
						<select id="charMode">
							<option value="ascii" selected>ASCII (edge-aware)</option>
							<option value="block">Block (‚ñà‚ñì‚ñí‚ñë)</option>
						</select>
					</div>
				</div>

				<!-- Trim -->
				<div class="row">
					<label>Trim</label>
					<div class="control" style="flex-direction: column; gap: 6px;">
						<div style="display:flex; width:100%; gap:8px;">
							<input type="number" id="start" placeholder="Start(s)" min="0"
								step="0.5" style="width:48%" />
							<input type="number" id="end" placeholder="End(s)" min="0"
								step="0.5" style="width:48%" />
						</div>
						<div class="dual-slider-wrapper"
							style="position:relative; width:100%; height:24px; display:flex; align-items:center;">
							<div
								style="position:absolute; width:100%; height:6px; background:var(--border); border-radius:3px;">
							</div>
							<div id="trimFillRail"
								style="position:absolute; height:6px; background:linear-gradient(90deg, var(--accent), var(--accent2)); border-radius:3px; z-index:1;">
							</div>
							<input type="range" class="dual-slider" id="trimStartSlider"
								min="0" max="100" value="0" step="0.1" />
							<input type="range" class="dual-slider" id="trimEndSlider"
								min="0" max="100" value="100" step="0.1" />
						</div>
					</div>
				</div>
				<!-- Crop -->
				<div class="row">
					<label>Crop</label>
					<div class="control" style="flex-wrap: wrap; gap: 4px;">
						<div
							style="width:100%; display:flex; justify-content:space-between; align-items:center;">
							<button id="toggleCropBtn" class="btn btn-secondary"
								style="padding: 3px 8px; font-size: 0.72rem; width:100%;">‚úÇÔ∏è
								Toggle Crop Bounds</button>
						</div>
						<div style="display:none;">
							<input type="number" id="cropW" placeholder="Width" min="0" />
							<input type="number" id="cropH" placeholder="Height" min="0" />
							<input type="number" id="cropX" placeholder="X" min="0" />
							<input type="number" id="cropY" placeholder="Y" min="0" />
						</div>
					</div>
				</div>
				<!-- Options -->
				<div class="row">
					<label>Options</label>
					<div class="control" style="flex-direction: column; gap: 8px;">
						<label style="display:flex; align-items:center; gap:8px;">
							<input type="checkbox" id="skipGif" />
							<span>Skip GIF generation (faster processing)</span>
						</label>
					</div>
				</div>
				<!-- Brightness -->
				<div class="row">
					<label for="brightnessAdj">Brightness</label>
					<div class="control">
						<input type="range" id="brightnessAdj" min="-100" max="100" value="0" />
						<span class="range-value" id="brightVal">0</span>
					</div>
				</div>
				<!-- Contrast -->
				<div class="row">
					<label for="contrastAdj">Contrast</label>
					<div class="control">
						<input type="range" id="contrastAdj" min="-100" max="100" value="0" />
						<span class="range-value" id="contrastVal">0</span>
					</div>
				</div>
				<!-- Foreground separation -->
				<div class="row">
					<label>Foreground</label>
					<div class="control"
						style="flex-direction:column; align-items:flex-start; gap:8px">
						<div class="checkbox-row">
							<input type="checkbox" id="fgEnable" />
							<span>Isolate subject</span>
						</div>
						<div class="control hidden" id="fgOptions"
							style="gap:8px; width:100%; flex-wrap:wrap">
							<select id="fgMode" style="min-width:140px">
								<option value="motion" selected>Motion mask</option>
								<option value="ml">ML segmentation</option>
							</select>
							<select id="fgBackground" style="min-width:160px">
								<option value="transparent">Transparent background
								</option>
								<option value="solid" selected>Solid background</option>
								<option value="keep">Freeze background</option>
							</select>
						</div>
						<div class="control hidden" id="fgThresholdRow"
							style="gap:8px; width:100%; align-items:center">
							<span style="font-size:0.75rem;color:var(--muted);min-width:60px"
								id="fgThresholdLabel">Sensitivity</span>
							<input type="range" id="fgThreshold" min="5" max="80" value="20"
								step="1" />
							<span class="range-value" id="fgThresholdVal">20</span>
						</div>
						<div class="control hidden" id="fgBgRow" style="gap:8px; width:100%">
							<input type="color" id="fgBg" value="#000000" />
							<span class="range-value" id="fgBgVal">#000000</span>
						</div>
					</div>
				</div>
			</div>

			<!-- Estimate -->
			<div class="estimate hidden" id="estimateArea">
				Estimated bundle: <span class="val" id="estimateVal">‚Äî</span>
			</div>

			<!-- Action buttons -->
			<div style="display:flex; gap:8px">
				<button class="btn btn-primary" id="convertBtn" disabled style="flex:1">‚ñ∂
					Convert</button>
				<button class="btn btn-primary" id="stopBtn"
					style="flex:1; display:none; background:var(--danger)">‚ñ† Stop</button>
			</div>

			<!-- Progress -->
			<div class="progress-area" id="progressArea">
				<div class="progress-bar-track">
					<div class="progress-bar-fill" id="progressFill"></div>
				</div>
				<div class="progress-label" id="progressLabel">Starting‚Ä¶</div>
			</div>

			<!-- Log -->
			<div class="log-area" id="logArea">
				<div class="log-box" id="logBox"></div>
			</div>
		</div>
	</div>

	<script type="module" src="/app.js"></script>
</body>

</html>